<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>商品管理</title>
  <link rel="stylesheet" th:href="@{/css/style.css}">
  <script th:src="@{/js/admin.js}" defer></script>
</head>

<body>
  <div class="container">
    <!-- ナビゲーション -->
    <div class="sidebar">
      <p>管理者：<strong th:text="${name}">[Name]</strong>様</p>
      <button class="nav-button" th:classappend="${activePage == 'forecast'} ? ' active' : ''"
        onclick="location.href='/forecast'">発注予測</button>
      <button class="nav-button" th:classappend="${activePage == 'user_manage'} ? ' active' : ''"
        onclick="location.href='/user_manage'">ユーザー管理</button>
      <button class="nav-button" th:classappend="${activePage == 'product_list'} ? ' active' : ''"
        onclick="location.href='/product_list'">商品管理</button>
      <button class="nav-button" th:classappend="${activePage == 'sale_input'} ? ' active' : ''"
        onclick="location.href='/admin/sale/input'">販売実績入力</button>
      <button class="nav-button" th:classappend="${activePage == 'calendar'} ? ' active' : ''"
        onclick="location.href='/calendar'">販売実績一覧</button>
      <a class="logout-link" href="#" onclick="document.getElementById('logoutForm').submit(); return false;">ログアウト</a>    </div>
    <form id="logoutForm" th:action="@{/logout}" method="post" style="display: none;"></form>

    <!-- メイン表示 -->
    <div class="main-content" id="mainContent">
      <h1>商品管理画面</h1>
      <p>ここにコンテンツを書く</p>


      <h2>商品一覧</h2>
      <table border="1" id="productTable">
        <thead>
          <tr>
            <th>商品ID</th>
            <th>商品名</th>
            <th>価格</th>
            <th>JANコード</th>
            <th></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <p><a href="#" onclick="openAddModal()">商品追加＋</a></p>
    </div>
  </div>
  <!-- 商品追加モーダル -->
  <div class="modal" id="addModal">
    <div class="modal-content">
      <h3>商品追加</h3>
      <label>商品ID：<input type="text" id="addId"></label>
      <label>商品名：<input type="text" id="addName"></label>
      <label>価格：<input type="number" id="addPrice"></label>
      <label>JANコード：<input type="text" id="addJan"></label>
      <button onclick="closeModal('addModal')">戻る</button>
      <button onclick="addProduct()">追加</button>
    </div>
  </div>
  <!-- 商品編集モーダル -->
  <div class="modal" id="editModal">
    <div class="modal-content">
      <h3>商品編集</h3>
      <label>商品ID：<input type="text" id="editId"></label>
      <label>商品名：<input type="text" id="editName"></label>
      <label>価格：<input type="number" id="editPrice"></label>
      <label>JANコード：<input type="text" id="editJan"></label>
      <button onclick="closeModal('editModal')">戻る</button>
      <button onclick="updateProduct()">変更</button>
    </div>
  </div>
  <script>
    let products = [];
    let editIndex = -1;
    function renderTable() {
      const tbody = document.querySelector("#productTable tbody");
      tbody.innerHTML = "";
      products.forEach((p, i) => {
        const row = `
<tr>
<td>${p.id}</td>
<td>${p.name}</td>
<td>${p.price}</td>
<td>${p.jan}</td>
<td><a href="#" onclick="openEditModal(${i})">編集</a></td>
</tr>
     `;
        tbody.innerHTML += row;
      });
    }
    function openAddModal() {
      document.getElementById("addId").value = "";
      document.getElementById("addName").value = "";
      document.getElementById("addPrice").value = "";
      document.getElementById("addJan").value = "";
      document.getElementById("addModal").style.display = "block";
    }
    function addProduct() {
      const id = document.getElementById("addId").value;
      const name = document.getElementById("addName").value;
      const price = document.getElementById("addPrice").value;
      const jan = document.getElementById("addJan").value;
      products.push({ id, name, price, jan });
      closeModal("addModal");
      renderTable();
    }
    function openEditModal(index) {
      editIndex = index;
      const p = products[index];
      document.getElementById("editId").value = p.id;
      document.getElementById("editName").value = p.name;
      document.getElementById("editPrice").value = p.price;
      document.getElementById("editJan").value = p.jan;
      document.getElementById("editModal").style.display = "block";
    }
    function updateProduct() {
      const p = products[editIndex];
      p.id = document.getElementById("editId").value;
      p.name = document.getElementById("editName").value;
      p.price = document.getElementById("editPrice").value;
      p.jan = document.getElementById("editJan").value;
      closeModal("editModal");
      renderTable();
    }
    function closeModal(id) {
      document.getElementById(id).style.display = "none";
    }
    // 初期表示用ダミーデータ
    products = [
      { id: "PROD0001", name: "ビールA", price: 800, jan: "1234567890" },
      { id: "PROD0002", name: "ビールB", price: 950, jan: "2345678901" }
    ];
    renderTable();
  </script>

</body>

</html>